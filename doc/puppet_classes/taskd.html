<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: taskd
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::taskd";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (t)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">taskd</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: taskd</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/init.pp
    </dd>
  </dl>
</div>

  <h2>Summary</h2>
  Installs and configures the taskwarrior taskd server.

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    <p>taskd</p>

<p>Installs and configures the taskwarrior taskd server.
It will generate self-signed certificates in the default configuration.
Module defaults are sourced from hiera.</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_taskd'>taskd</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>package_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The package name of taskd to use for installation.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The installed service name for taskd.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config_file</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Location of the taskd configuration.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>owner</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Owner for files/directories. Should be the taskd user.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>group</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Group for files/directories. Should be the taskd user's group.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>(Additional) configuration options that should be defined; the module supplies minimal defaults via hiera.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>certificate</span>
      
      
        <span class='type'>(<tt>Struct[{
    client =&gt; Struct[{
      cert =&gt; String[1],
      key  =&gt; String[1],
    }],
    server =&gt; Struct[{
      cert =&gt; String[1],
      key  =&gt; String[1],
      crl  =&gt; String[1],
    }],
    ca     =&gt; Struct[{
      cert =&gt; String[1],
    }],
  }]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Hash of configuration settings for client, server and ca cert/key/crl.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pki_base_dir</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Base directory of the taskd PKI scripts. Only used when $generate_certificates is true.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pki_vars_file</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Location to put PKI vars file for generation. Only used when $generate_certificates is true.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pki_vars</span>
      
      
        <span class='type'>(<tt>Optional[Struct[{
    bits            =&gt; Numeric,
    expiration_days =&gt; Numeric,
    cn              =&gt; String[1],
    organization    =&gt; String[1],
    country         =&gt; String[1],
    state           =&gt; String[1],
    locality        =&gt; String[1],
  }]]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>PKI variables for generation certificates. Only used when $generate_certificates is true.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>generate_certificates</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Generate self-signed certificates with the taskd PKI. Defaults to 'true'.</p>
</div>
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/init.pp', line 34</span>

class taskd (
  String $package_name,
  String $service_name,
  String $config_file,
  String $owner,
  String $group,
  Hash $config,
  Struct[{
    client =&gt; Struct[{
      cert =&gt; String[1],
      key  =&gt; String[1],
    }],
    server =&gt; Struct[{
      cert =&gt; String[1],
      key  =&gt; String[1],
      crl  =&gt; String[1],
    }],
    ca     =&gt; Struct[{
      cert =&gt; String[1],
    }],
  }] $certificate,
  Optional[String] $pki_base_dir,
  Optional[String] $pki_vars_file,
  Optional[Struct[{
    bits            =&gt; Numeric,
    expiration_days =&gt; Numeric,
    cn              =&gt; String[1],
    organization    =&gt; String[1],
    country         =&gt; String[1],
    state           =&gt; String[1],
    locality        =&gt; String[1],
  }]] $pki_vars,
  Boolean $generate_certificates = true,
) {
  package { $package_name:
    ensure =&gt; present,
  }

  # Generate taskserver certificates unless user says otherwise
  if $generate_certificates {
    # Location for the SSL variable file
    file { $pki_vars_file:
      ensure  =&gt; present,
      content =&gt; template(&#39;taskd/vars.erb&#39;),
      require =&gt; Package[$package_name],
      owner   =&gt; $owner,
      group   =&gt; $group,
    }

    [ &#39;ca&#39;, &#39;server&#39;, &#39;client&#39;].each |String $type| {
      exec { &quot;Generate taskserver ${type} certificates&quot;:
        command =&gt; &quot;${pki_base_dir}/generate.${type}&quot;,
        cwd     =&gt; $config[&#39;root&#39;],
        path    =&gt; [ &#39;/usr/bin&#39;, &#39;/usr/sbin&#39;, &#39;/bin&#39;, &#39;/sbin&#39; ],
        creates =&gt; $certificate[$type][&#39;cert&#39;],
        user    =&gt; $owner,
      }
    }

    exec { &#39;Generate taskserver revocation list&#39;:
      command =&gt; &quot;${pki_base_dir}/generate.crl&quot;,
      cwd     =&gt; $config[&#39;root&#39;],
      path    =&gt; [ &#39;/usr/bin&#39;, &#39;/usr/sbin&#39;, &#39;/bin&#39;, &#39;/sbin&#39; ],
      creates =&gt; $certificate[&#39;server&#39;][&#39;crl&#39;],
      user    =&gt; $owner,
    }
  }

  # Template out configuration file
  file { $config_file:
    ensure  =&gt; present,
    content =&gt; template(&#39;taskd/config.erb&#39;),
    owner   =&gt; $owner,
    group   =&gt; $group,
    notify  =&gt; Service[$service_name],
  }

  # Ensure the taskd root directory exists
  file { $config[&#39;root&#39;]:
    ensure =&gt; directory,
    owner  =&gt; $owner,
    group  =&gt; $group,
  }

  # Ensure the organization directory exists
  file { &quot;${config[&#39;root&#39;]}/orgs&quot;:
    ensure =&gt; directory,
    owner  =&gt; $owner,
    group  =&gt; $group,
  }

  # Ensures service is running after configuration has been rolled out.
  service { $service_name:
    ensure  =&gt; running,
    enable  =&gt; true,
    require =&gt; Package[$package_name],
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>